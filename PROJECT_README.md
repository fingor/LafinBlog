# 智能银行数据问答系统

## 项目概述

这是一个基于Vue3 + Supabase的智能银行数据问答系统，支持自然语言查询银行业务数据，自动转换为SQL语句并返回可视化结果。

## 核心功能

### 1. 自然语言查询
- 支持中文自然语言输入
- 智能识别指标、维度、时间等实体
- 自动生成对应的SQL查询语句
- 支持时间对比、地区对比、机构对比等多种查询模式

### 2. 数据架构
- **角色表**: 银行组织架构（总行、分行、支行）
- **指标表**: 银行业务指标定义（贷款人数、存款余额等）
- **维度表**: 业务维度（时间、地区、产品等）
- **事实表**: 核心业务数据存储
- **查询模板**: 预定义的自然语言到SQL的转换模板

### 3. 智能解析引擎
- 实体识别：自动识别查询中的指标、地区、机构、时间等
- 同义词支持：支持多种表达方式（如"农行"="农业银行"）
- 模板匹配：根据查询模式匹配最佳SQL模板
- SQL生成：自动生成优化的SQL查询语句

### 4. 可视化展示
- 多种图表类型：折线图、柱状图、饼图、仪表盘
- 自适应布局：支持移动端和桌面端
- 数据导出：支持CSV格式导出
- 查询历史：保存和复用历史查询

## 技术栈

- **前端**: Vue3 + TypeScript + Element Plus
- **后端**: Supabase (PostgreSQL + Realtime)
- **图表**: 原生Canvas绘制
- **路由**: Vue Router 4
- **状态管理**: Vue Composition API

## 快速开始

### 1. 安装依赖
```bash
npm install
```

### 2. 配置Supabase
1. 创建Supabase项目
2. 复制`.env.example`为`.env`
3. 填写Supabase URL和Anon Key

### 3. 运行数据库迁移
```bash
# 在Supabase控制台执行 supabase/migrations/20241119_create_bank_analytics_schema.sql
```

### 4. 启动开发服务器
```bash
npm run dev
```

## 使用示例

### 示例查询
1. **机构指标查询**: "农业银行广东省分行的当月贷款人数是多少？"
2. **时间对比分析**: "本月和上月相比，存款余额有什么变化？"
3. **地区趋势分析**: "广东省的贷款客户数最近趋势如何？"
4. **多机构对比**: "各分行的营业收入对比"

### 支持的查询模式
- `{机构}的{指标}` - 查询特定机构的指标
- `{地区}的{指标}` - 查询特定地区的指标
- `{指标}在{时间1}和{时间2}的对比` - 时间对比分析
- `{指标}趋势` - 趋势分析

## 数据库设计

### 核心表结构

1. **roles** - 银行组织架构
2. **metrics** - 业务指标定义
3. **dimensions** - 维度定义
4. **fact_bank_metrics** - 事实数据表
5. **nl_query_templates** - 自然语言查询模板
6. **entity_synonyms** - 实体同义词

### 数据初始化

系统预置了以下数据：
- 农业银行组织架构数据
- 常见银行业务指标（贷款、存款、客户等）
- 地区维度数据（广东省、北京市、上海市等）
- 产品维度数据（贷款、存款、理财等）
- 自然语言查询模板
- 实体同义词映射

## API接口

### 智能问答API
- `POST /api/smart-qa/query` - 处理自然语言查询
- `GET /api/smart-qa/metrics` - 获取可用指标列表
- `GET /api/smart-qa/regions` - 获取可用地区列表
- `GET /api/smart-qa/organizations` - 获取可用机构列表

### 数据库操作API
- 基于Supabase的自动生成API
- 支持实时数据同步
- 内置权限控制

## 扩展开发

### 添加新的查询模板
1. 在`nl_query_templates`表中添加新模板
2. 定义模板模式和SQL模板
3. 指定需要的实体类型

### 添加实体同义词
1. 在`entity_synonyms`表中添加同义词
2. 指定实体类型和对应的实体ID

### 自定义图表类型
1. 在`src/components/charts/`目录下创建新的图表组件
2. 在智能问答组件中注册新的图表类型

## 性能优化

- 实体缓存机制
- SQL查询优化
- 前端组件懒加载
- 图表渲染优化

## 安全特性

- Supabase RLS（行级安全）
- API访问控制
- 数据权限管理
- 查询参数验证

## 部署说明

### 生产环境部署
1. 构建项目：`npm run build`
2. 配置生产环境变量
3. 部署到静态托管服务（Vercel、Netlify等）
4. 配置Supabase生产环境

### 环境变量
```
VITE_SUPABASE_URL=your_production_supabase_url
VITE_SUPABASE_ANON_KEY=your_production_anon_key
```

## 贡献指南

欢迎提交Issue和Pull Request来改进项目。

## 许可证

MIT License